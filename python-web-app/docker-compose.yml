version: "2"

services:
  # load balancer
  lb:
    container_name: pythonwebapp_lb
    image: nginx:1.9
    entrypoint: nginx
    command: -g "daemon off;" -c /etc/conf/nginx.conf
    restart: unless-stopped
    networks:
      - backend
    ports:
      - "80:80"
    labels:
      - "interlock.ext.name=nginx"
    volumes_from:
      - container:pythonwebapp_nginx_config:ro
    environment:
      - constraint:node==*n1

  # app
  app:
    image: ehazlett/docker-demo:latest
    restart: unless-stopped
    networks:
      - backend
    expose:
      - 8080
    labels:
        - "interlock.hostname=test"
        - "interlock.domain=local"

networks:
  backend: {}
